---

---

<script client:load>
  function parsePath(pathname) {
    const album = pathname.match(/^\/album\/(\w+)$/);
    if (album) return { type: "album", albumId: album[1] };
    return { type: "home" };
  }

  function routeTo(url, replace = false) {
    const state = {};
    replace
      ? history.replaceState(state, "", url)
      : history.pushState(state, "", url);
    handle();
  }

  function handle() {
    const r = parsePath(location.pathname);
    if (r.type === "home") {
      dispatch("route:home");
    } else if (r.type === "album") {
      dispatch("route:album", { albumId: r.albumId });
    }
  }

  function dispatch(name, detail) {
    window.dispatchEvent(new CustomEvent(name, { detail }));
  }

  window.addEventListener("nav:album", (e) => {
    const { albumId } = e.detail;
    routeTo(`/album/${albumId}`);
  });

  window.addEventListener("ui:track", (e) => {
    const {
      albumId,
      trackIdx,
      trackName,
      imgAlbum,
      artistImg,
      trackArtists,
      bioArtist,
      artistName,
      albumName,
    } = e.detail;

    dispatch("route:track", {
      albumId,
      trackIdx,
      trackName,
      imgAlbum,
      artistImg,
      trackArtists,
      bioArtist,
      artistName,
      albumName,
    });
  });

  window.addEventListener("popstate", handle);
  window.addEventListener("DOMContentLoaded", handle);
</script>
